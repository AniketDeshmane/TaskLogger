<Window x:Class="TaskLogger.Views.HistoryWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Task History" 
        Height="600" 
        Width="800"
        WindowStartupLocation="CenterOwner"
        Background="{StaticResource BackgroundBrush}">
    
    <Grid Margin="20">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>
        
        <!-- Header -->
        <Border Grid.Row="0" Style="{StaticResource ModernCard}" Margin="0,0,0,20">
            <StackPanel>
                <TextBlock Text="ðŸ“‹ Task History" 
                          FontSize="24" 
                          FontWeight="Bold" 
                          Foreground="{StaticResource PrimaryBrush}"
                          HorizontalAlignment="Center"
                          Margin="0,0,0,8"/>
                <TextBlock Text="View all your logged tasks and accomplishments" 
                          FontSize="14" 
                          Foreground="{StaticResource TextSecondaryBrush}"
                          HorizontalAlignment="Center"/>
            </StackPanel>
        </Border>
        
        <!-- History Content -->
        <Border Grid.Row="1" Style="{StaticResource ModernCard}">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>
                
                <!-- Search/Filter -->
                <StackPanel Grid.Row="0" Margin="0,0,0,15">
                    <StackPanel Orientation="Horizontal" Margin="0,0,0,10">
                        <TextBox Style="{StaticResource ModernTextBox}"
                                Width="200"
                                Text="{Binding SearchText, UpdateSourceTrigger=PropertyChanged}"/>
                        <Button Content="Clear" 
                               Style="{StaticResource ModernButton}"
                               Command="{Binding ClearSearchCommand}"
                               Margin="10,0,0,0"
                               Background="{StaticResource SecondaryBrush}"/>
                    </StackPanel>
                    <TextBlock Text="{Binding TaskCountText}" 
                              FontSize="12" 
                              Foreground="{StaticResource TextSecondaryBrush}"
                              HorizontalAlignment="Left"/>
                </StackPanel>
                
                <!-- History List -->
                <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto">
                    <ItemsControl ItemsSource="{Binding Tasks}">
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Border Background="{StaticResource CardBrush}" 
                                        CornerRadius="8" 
                                        Padding="15" 
                                        Margin="0,0,0,10">
                                    <Border.Effect>
                                        <DropShadowEffect Color="Black" 
                                                        Opacity="0.1" 
                                                        BlurRadius="8" 
                                                        ShadowDepth="2"/>
                                    </Border.Effect>
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="Auto"/>
                                        </Grid.ColumnDefinitions>
                                        
                                        <StackPanel Grid.Column="0">
                                            <StackPanel Orientation="Horizontal" Margin="0,0,0,5">
                                                <TextBlock Text="{Binding Timestamp}" 
                                                          FontSize="12" 
                                                          FontWeight="SemiBold" 
                                                          Foreground="{StaticResource PrimaryBrush}"/>
                                                <TextBlock Text="{Binding EventType, StringFormat=' [{0}]'}" 
                                                          FontSize="11" 
                                                          FontWeight="SemiBold" 
                                                          Foreground="{StaticResource SecondaryBrush}"
                                                          Visibility="{Binding EventType, Converter={StaticResource StringToVisibilityConverter}}"/>
                                            </StackPanel>
                                            <TextBlock Text="{Binding Task}" 
                                                      FontSize="14" 
                                                      Foreground="{StaticResource TextBrush}"
                                                      TextWrapping="Wrap"
                                                      x:Name="TaskTextBlock"
                                                      Visibility="{Binding IsEditing, Converter={StaticResource InverseBooleanToVisibilityConverter}}"/>
                                            <TextBox Text="{Binding Task, UpdateSourceTrigger=PropertyChanged}" 
                                                    FontSize="14" 
                                                    TextWrapping="Wrap"
                                                    AcceptsReturn="True"
                                                    Visibility="{Binding IsEditing, Converter={StaticResource BooleanToVisibilityConverter}}"
                                                    Style="{StaticResource ModernTextBox}"
                                                    Margin="0,0,0,5"/>
                                            <TextBlock Text="{Binding Notes}" 
                                                      FontSize="11" 
                                                      Foreground="{StaticResource TextSecondaryBrush}"
                                                      FontStyle="Italic"
                                                      TextWrapping="Wrap"
                                                      Margin="0,5,0,0"
                                                      Visibility="{Binding Notes, Converter={StaticResource StringToVisibilityConverter}}"/>
                                        </StackPanel>
                                        
                                        <StackPanel Grid.Column="1" Orientation="Horizontal" VerticalAlignment="Top" Margin="10,0,0,0">
                                            <Button Content="âœï¸" 
                                                   ToolTip="Edit"
                                                   Width="30" 
                                                   Height="30"
                                                   Margin="0,0,5,0"
                                                   Click="EditButton_Click"
                                                   Tag="{Binding}"
                                                   Visibility="{Binding IsEditing, Converter={StaticResource InverseBooleanToVisibilityConverter}}"
                                                   Style="{StaticResource ModernButton}"
                                                   Background="{StaticResource AccentBrush}"/>
                                            <Button Content="ðŸ’¾" 
                                                   ToolTip="Save"
                                                   Width="30" 
                                                   Height="30"
                                                   Margin="0,0,5,0"
                                                   Click="SaveButton_Click"
                                                   Tag="{Binding}"
                                                   Visibility="{Binding IsEditing, Converter={StaticResource BooleanToVisibilityConverter}}"
                                                   Style="{StaticResource ModernButton}"
                                                   Background="{StaticResource SuccessBrush}"/>
                                            <Button Content="âŒ" 
                                                   ToolTip="Cancel"
                                                   Width="30" 
                                                   Height="30"
                                                   Margin="0,0,5,0"
                                                   Click="CancelButton_Click"
                                                   Tag="{Binding}"
                                                   Visibility="{Binding IsEditing, Converter={StaticResource BooleanToVisibilityConverter}}"
                                                   Style="{StaticResource ModernButton}"
                                                   Background="{StaticResource SecondaryBrush}"/>
                                            <Button Content="ðŸ—‘ï¸" 
                                                   ToolTip="Delete"
                                                   Width="30" 
                                                   Height="30"
                                                   Click="DeleteButton_Click"
                                                   Tag="{Binding}"
                                                   Style="{StaticResource ModernButton}"
                                                   Background="{StaticResource ErrorBrush}"/>
                                        </StackPanel>
                                    </Grid>
                                </Border>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </ScrollViewer>
            </Grid>
        </Border>
        
        <!-- Footer -->
        <StackPanel Grid.Row="2" Orientation="Horizontal" 
                   HorizontalAlignment="Right" 
                   Margin="0,20,0,0">
            <Button Content="ðŸ“¤ Export" 
                   Style="{StaticResource ModernButton}"
                   Command="{Binding ExportCommand}"
                   Margin="0,0,10,0"/>
            <Button Content="Close" 
                   Style="{StaticResource ModernButton}"
                   Click="CloseButton_Click"
                   Background="{StaticResource SecondaryBrush}"/>
        </StackPanel>
    </Grid>
</Window>
